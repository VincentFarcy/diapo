{% extends 'base.html.twig' %}

{% block title %}Liste des albums{% endblock %}

{% block body %}

<div class="container">


    {% set route = app.request.attributes.get('_route') %}
    {% set id = app.request.attributes.get('id') %}

    <header class ="row mb-3">
    
        <h1 class="col-8">Liste des albums</h1>

        <form class="col-2" action="{{ path('albums_by_author', {'id': 0}) }}">
            <select class="filter form-control">
                <option value="0">Auteurs</option>

                {% for author in authors %}

                    {% set selected = '' %}
                    {% if (route == 'albums_by_author') and (id == author.id) %}>
                        {% set selected = 'selected' %}
                    {% endif %}

                    <option value={{ author.id }} {{selected}}>{{ author.firstname }} {{ author.lastname }}</option>

                {% endfor %}

            </select>
        </form>

        <form class="col-2" action="{{ path('albums_by_tag', {'id': 0}) }}">

            <select class="filter form-control">
                <option value="0">Etiquettes</option>

                {% for tag in tags %}

                    {% set selected = '' %}
                    {% if (route == 'albums_by_tag') and (id == tag.id) %}>
                        {% set selected = 'selected' %}
                    {% endif %}

                    <option value={{ tag.id }} {{selected}}> {{ tag.title }}</option>

                {% endfor %}

            </select>
        </form>

    </header>

    <main class="album-list">

        <div class="jumbotron d-flex flex-wrap justify-content-between">

            {% for album in albums %}

                {% set priority = 999999 %}
                {% set featured_image = null %}
                {% for image in album.images %}

                    {% if featured_image == null or image.priority < priority %}
                        {% set featured_image = image %}
                        {% set priority = image.priority %}
                    {% endif %}

                {% endfor %}

                {% set birthday = false %}
                {% set birthday_css_class = '' %}
                {% if (album.author.birthday|date("m/d") == 'now'|date("m/d")) %}
                    {% set birthday = true %}
                    {% set birthday_css_class = 'birthday' %}
                {% endif %}

                {% set colors = ['primary', 'secondary', 'success', 'info', 'warning'] %}

                <article class="card text-white bg-{{ cycle(colors, loop.index0) }} mb-3 {{ birthday_css_class }}" style="max-width: 20rem;">

                    <div class="card-header d-flex justify-content-between">
                        <p>{{ album.author.firstname }} {{ album.author.lastname }}</p>
                        {% if birthday %}
                            <i class="fa fa-birthday-cake" aria-hidden="true"></i>
                        {% endif %}
                    </div>
                    <div class="card-body">
                        <h4 class="card-title">
                            <a class="text-white" href="{{ path('album_read', {'id': album.id}) }}">{{ album.title|nl2br }}</a>
                        </h4>
                        <p class="card-text">
                            <a href="{{ path('album_read', {'id': album.id}) }}">
                                {% if featured_image %} 
                                    <img 
                                        src="{{ asset(image_directory|replace({'/public/' : ''}) ~ '/' ~ featured_image.src) }}" 
                                        alt="{{ featured_image.alt }}"
                                    />
                                {% endif %}
                            </a>
                        </p>
                        <div>
                            {% for tag in album.tags %}
                                {{ tag.title }}
                            {% endfor %}
                        </div>
                    </div>

                </article>

            {% endfor %}

        </div>
    </main>

    <footer></footer>


</div>

{% endblock %}
